jQuery(document).ready(function(){console.log("Localized ai_scribe object:",ai_scribe);jQuery(window).on("load",function(){jQuery("#first").addClass("save-btn");jQuery(".second_form").show();jQuery(".first_form").hide()});jQuery("#first").click(function(e){e.preventDefault();jQuery(this).addClass("save-btn");jQuery("#second").removeClass("save-btn");jQuery(".second_form").show();jQuery(".first_form").hide()});jQuery("#second").click(function(e){e.preventDefault();jQuery(this).addClass("save-btn");jQuery("#first").removeClass("save-btn");jQuery(".first_form").show();jQuery(".second_form").hide()});jQuery("#frmFirst").submit(function(e){e.preventDefault();if(typeof ai_scribe==="undefined"||!ai_scribe.nonce||!ai_scribe.ajaxUrl){console.error("ai_scribe is not defined or missing properties. Please check wp_localize_script in PHP.");alert("Unable to process the request. Please refresh the page and try again.");return}var first_form=jQuery(this).serialize()+"&security="+ai_scribe.nonce;jQuery.ajax({type:"POST",dataType:"json",url:ai_scribe.ajaxUrl,data:first_form,success:function(response){if(response.success){alert(response.data.msg||response.msg||"Settings saved successfully!");location.reload()}else{var errorMsg="An unknown error occurred.";if(response.data&&response.data.msg){errorMsg=response.data.msg}else if(response.msg){errorMsg=response.msg}else if(response.data&&typeof response.data==="string"){errorMsg=response.data}alert("Error: "+errorMsg)}},error:function(xhr,status,error){console.error("AJAX Error:",status,error);alert("Failed to save settings. Please try again later.")}})});jQuery("#al_engine").submit(function(e){e.preventDefault();if(typeof ai_scribe==="undefined"){console.error("ai_scribe is not defined. Please check wp_localize_script in PHP.");alert("Unable to process the request. Please refresh the page and try again.");return}const selectedModel=jQuery("select[name=\"model\"]").val();const isAnthropic=selectedModel&&selectedModel.startsWith("claude-");const isOpenAI=selectedModel&&!isAnthropic;const imageGenerationEnabled=jQuery("input[name=\"enable_image_generation\"]").is(":checked");const openaiKey=jQuery("input[name=\"api_key\"]").val().trim();const anthropicKey=jQuery("input[name=\"anthropic_api_key\"]").val().trim();if(isAnthropic&&!anthropicKey){alert("Anthropic API key is required for Claude models. Please add your Anthropic API key before saving.");jQuery("#anthropic_api_key").focus();return}if(isOpenAI&&!openaiKey){alert("OpenAI API key is required for GPT models. Please add your OpenAI API key before saving.");jQuery("#openai_api_key").focus();return}if(isAnthropic&&imageGenerationEnabled&&!openaiKey){alert("Both Anthropic and OpenAI API keys are required when using Claude models with image generation enabled. OpenAI key is needed for image generation.");jQuery("#openai_api_key").focus();return}var ai_engine_frm=jQuery(this).serialize()+"&security="+ai_scribe.nonce;jQuery.ajax({type:"POST",dataType:"json",url:ai_scribe.ajaxUrl,data:ai_engine_frm,success:function(response){if(response.success){alert(response.data.msg||response.msg||"Settings saved successfully!");location.reload()}else{var errorMsg="An unknown error occurred.";if(response.data&&response.data.msg){errorMsg=response.data.msg}else if(response.msg){errorMsg=response.msg}else if(response.data&&typeof response.data==="string"){errorMsg=response.data}alert("Error: "+errorMsg)}},error:function(xhr,status,error){console.error("AJAX Error:",status,error);alert("Failed to save settings. Please try again later.")}})});function toggleParameterVisibility(){const selectedModel=jQuery("#model-select").val();const isO3=selectedModel&&(selectedModel==="o3"||selectedModel==="o3-mini");const isOpenAI=selectedModel&&(selectedModel.startsWith("gpt-")||isO3);const isAnthropic=selectedModel&&selectedModel.startsWith("claude-");console.log("Selected model:",selectedModel,"isO3:",isO3,"isOpenAI:",isOpenAI,"isAnthropic:",isAnthropic);const allParams=["temp","top_p","best_oi","freq_pent","Presence_penalty"];allParams.forEach(function(param){const paramDiv=jQuery("input[name=\""+param+"\"]").closest(".form-row");paramDiv.hide()});jQuery("#temperature-input").hide();jQuery("#reasoning-effort-select").hide();if(isO3){console.log("Showing reasoning effort dropdown for o3 model");jQuery("#reasoning-effort-select").show()}else if(isOpenAI){jQuery("#temperature-input").show();const openaiParams=["top_p","best_oi","freq_pent","Presence_penalty"];openaiParams.forEach(function(param){const paramDiv=jQuery("input[name=\""+param+"\"]").closest(".form-row");paramDiv.show()})}else if(isAnthropic){jQuery("#temperature-input").show();const anthropicParams=["top_p"];anthropicParams.forEach(function(param){const paramDiv=jQuery("input[name=\""+param+"\"]").closest(".form-row");paramDiv.show()})}const openaiKeySection=jQuery("#openai_api_key").closest(".gform");const anthropicKeySection=jQuery("#anthropic_api_key").closest(".gform");const imageGenerationEnabled=jQuery("#enable_image_generation").is(":checked");if(isOpenAI){openaiKeySection.show();anthropicKeySection.hide()}else if(isAnthropic){anthropicKeySection.show();if(imageGenerationEnabled){openaiKeySection.show()}else{openaiKeySection.hide()}}else{openaiKeySection.show();anthropicKeySection.show()}updateImageGenerationAvailability();const apiMessage=jQuery(".api-keys-section p");if(isAnthropic){if(imageGenerationEnabled){apiMessage.html("<strong>Important:</strong> You've selected a Claude model with image generation enabled. You need <strong>both</strong> an Anthropic API key (for text) and an OpenAI API key (for images).")}else{apiMessage.html("<strong>Important:</strong> You've selected a Claude model. You need an Anthropic API key for text generation. OpenAI key not required since image generation is disabled.")}}else if(isOpenAI){if(imageGenerationEnabled){apiMessage.html("<strong>Important:</strong> You've selected an OpenAI model with image generation enabled. You need an OpenAI API key for both text and image generation.")}else{apiMessage.html("<strong>Important:</strong> You've selected an OpenAI model. You need an OpenAI API key for text generation.")}}else{apiMessage.html("<strong>Important:</strong> You need an Anthropic API key for Claude models and an OpenAI API key for GPT models and image generation. If you plan to use Claude models with image generation, you'll need <strong>both</strong> API keys.")}}function updateImageGenerationAvailability(){const openaiKey=jQuery("#openai_api_key").val().trim();const imageCheckbox=jQuery("#enable_image_generation");const selectedModel=jQuery("#model-select").val();const isAnthropic=selectedModel&&selectedModel.startsWith("claude-");const isOpenAI=selectedModel&&(selectedModel.startsWith("gpt-")||selectedModel==="o3"||selectedModel==="o3-mini");imageCheckbox.prop("disabled",false);if(!openaiKey){if(isAnthropic){showImageGenerationHint("claude")}else if(isOpenAI){showImageGenerationHint("openai")}else{showImageGenerationHint("general")}if(imageCheckbox.is(":checked")){jQuery("#image-generation-settings").show();showImageKeyWarning()}else{jQuery("#image-generation-settings").hide();hideImageKeyWarning()}}else{hideImageGenerationHint();hideImageKeyWarning();if(imageCheckbox.is(":checked")){jQuery("#image-generation-settings").show()}else{jQuery("#image-generation-settings").hide()}}}function showImageGenerationHint(type){let hint=jQuery("#image-generation-hint");let message="";switch(type){case"claude":message="<strong>üí° Want images with Claude?</strong> Add your OpenAI API key above to enable AI image generation alongside Claude text generation.";break;case"openai":message="<strong>‚ö†Ô∏è OpenAI API Key Required</strong> Add your OpenAI API key above to enable image generation.";break;default:message="<strong>üí° Image Generation Available</strong> Add your OpenAI API key above to enable AI image generation with any text model."}if(hint.length===0){hint=jQuery("<div id=\"image-generation-hint\" style=\"background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; padding: 10px; margin: 10px 0; color: #856404;\"></div>");jQuery("#image-generation-description").after(hint)}hint.html(message).show()}function showImageKeyWarning(){let warning=jQuery("#image-key-warning");if(warning.length===0){warning=jQuery("<div id=\"image-key-warning\" style=\"background: #f8d7da; border: 1px solid #dc3545; border-radius: 4px; padding: 10px; margin: 10px 0; color: #721c24;\"><strong>‚ö†Ô∏è Warning:</strong> Image generation is enabled but no OpenAI API key is provided. Images will not be generated until you add an OpenAI API key above.</div>");jQuery("#image-generation-settings").before(warning)}warning.show()}function hideImageGenerationHint(){jQuery("#image-generation-hint").hide()}function hideImageKeyWarning(){jQuery("#image-key-warning").hide()}toggleParameterVisibility();toggleImageGenerationSettings();jQuery("#model-select").on("change",function(){toggleParameterVisibility();updateImageGenerationAvailability()});function toggleImageGenerationSettings(){const isEnabled=jQuery("#enable_image_generation").is(":checked");const openaiKey=jQuery("#openai_api_key").val().trim();if(isEnabled){jQuery("#image-generation-settings").show();if(!openaiKey){showImageKeyWarning()}else{hideImageKeyWarning()}}else{jQuery("#image-generation-settings").hide();hideImageKeyWarning()}toggleParameterVisibility();validateApiKeys()}jQuery("#enable_image_generation").on("change",toggleImageGenerationSettings);function validateApiKeys(){const selectedModel=jQuery("#model-select").val();const isO3=selectedModel&&(selectedModel==="o3"||selectedModel==="o3-mini");const isOpenAI=selectedModel&&(selectedModel.startsWith("gpt-")||isO3);const isAnthropic=selectedModel&&selectedModel.startsWith("claude-");const imageGenerationEnabled=jQuery("#enable_image_generation").is(":checked");const openaiKey=jQuery("#openai_api_key").val().trim();const anthropicKey=jQuery("#anthropic_api_key").val().trim();jQuery("#openai_api_key, #anthropic_api_key").removeClass("required-missing");if(isOpenAI&&!openaiKey){jQuery("#openai_api_key").addClass("required-missing")}if(isAnthropic&&!anthropicKey){jQuery("#anthropic_api_key").addClass("required-missing")}if(isAnthropic&&imageGenerationEnabled&&!openaiKey){jQuery("#openai_api_key").addClass("required-missing")}}jQuery("#model-select, #enable_image_generation").on("change",validateApiKeys);jQuery("#openai_api_key, #anthropic_api_key").on("input",function(){validateApiKeys();updateImageGenerationAvailability();toggleImageGenerationSettings()});validateApiKeys();toggleParameterVisibility()});